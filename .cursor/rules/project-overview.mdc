---
description: Solid Octo Invention - Main project overview and architecture
alwaysApply: true
---

# Solid Octo Invention - Project Overview

You are an expert TypeScript developer working on a modern full-stack application built with:
- Backend: Graphile stack (PostGraphile, Worker, Migrate) with Effect-TS
- Frontend: React with Apollo Client and Effect-TS  
- Architecture: Domain-driven development with functional programming principles

## Core Principles

1. **Pure Functional Programming**: Use Effect-TS for all side effects and business logic
2. **Domain-Driven Development**: Clear separation between domain, application, and infrastructure layers
3. **Making Impossible States Impossible**: Use TypeScript type system to prevent invalid states
4. **Type Safety**: End-to-end type safety from database to UI

## Project Structure

```
packages/
├── backend/          # PostGraphile API server with Effect-TS services
├── frontend/         # React app with Apollo Client and Tailwind CSS
└── shared/           # Shared types, schemas, and utilities
```

## Key Technologies

- **Effect-TS**: Functional programming library for TypeScript
- **PostGraphile**: Automatic GraphQL API from PostgreSQL schema
- **Graphile Worker**: Background job processing
- **Graphile Migrate**: Database schema migrations
- **Apollo Client**: GraphQL client for React
- **React Router**: Client-side routing
- **Tailwind CSS**: Utility-first CSS framework
- **Vitest**: Testing framework
- **TypeScript**: Static type checking

## Development Guidelines

- Use relative imports for internal modules
- Implement proper error handling with tagged errors
- Add comprehensive logging and observability
- Write tests for all business logic
- Maintain clear separation of concerns
- Use semicolons in all TypeScript/JavaScript code
- Follow functional programming principles with Effect-TS

## Database Migration Rules

**CRITICAL**: Database migrations must NEVER be committed in development:

1. **NEVER commit migrations** - migrations are only committed on `prod` branch
2. **Always work with `current.sql`**:
   - Add all schema changes to `migrations/current.sql`
   - Never run `pnpm migrate:commit` in development
   - Keep all changes in `current.sql` until production deployment
3. **Migration workflow**:
   - Development: Work only with `migrations/current.sql`
   - Production: Only `prod` branch commits migrations automatically
   - CI validates schema consistency via schema dumps
4. **Schema validation**:
   - Post-migration script generates schema dumps
   - CI ensures schema dump matches expected state
   - Any schema drift causes CI failure

## Architecture Layers

1. **Domain Layer**: Pure business logic with Effect-TS
2. **Application Layer**: Use cases and orchestration
3. **Infrastructure Layer**: Database, external services, GraphQL resolvers
4. **Presentation Layer**: React components and Apollo Client integration

Always prioritize type safety, functional programming principles, and maintainable code structure.
